<!DOCTYPE html>
<html lang="fr"><head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Outil Production & Tournage ‚Äì L'Ar√®ne</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0f1723; color: #f2f2f2; margin: 0; padding: 1rem; }
    header { text-align: center; padding: 1rem 0; background: #1c2432; box-shadow: 0 0 10px #0005; }
    header h1 { margin: 0; color: #4fd1c5; font-size: 1.8em; }
    .tab { overflow: hidden; background: #1c2432; border-radius: 5px; margin-bottom: 1rem; }
    .tab button {
      background: inherit; border: none; outline: none; cursor: pointer;
      padding: 0.7rem 1rem; font-size: 1em; color: #ddd; transition: background 0.2s;
    }
    .tab button.active { background: #fcb900; color: #000; }
    .tabcontent { display: none; padding: 1rem 0; }
    .tabcontent.active { display: block; }

    details {
      background: #1c2432; margin: 1rem 0; border-radius: 8px;
      padding: 1rem; box-shadow: 0 0 10px #0005;
    }
    summary { font-size: 1.2em; font-weight: bold; color: #fcb900; cursor: pointer; }

    label { display: block; margin: 0.8rem 0 0.2rem; font-weight: 600; }
    input[type="text"], input[type="date"], input[type="time"], textarea, select {
      width: 100%; background: #111c2a; border: 1px solid #4fd1c5;
      color: #fff; padding: 0.5rem; font-size: 1rem; border-radius: 5px;
      box-sizing: border-box;
    }
    .flex-row { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem; }
    .flex-col { flex: 1; min-width: 200px; }

    .note-entry {
      display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;
      margin: 0.5rem 0;
    }
    .note-entry input { flex: 1; }

    .note-block {
      background: #0d1a2a; padding: 0.6rem; margin: 0.5rem 0;
      border-radius: 6px; border-left: 4px solid #4fd1c5; position: relative;
    }
    .note-block .meta { font-size: 0.85em; color: #aaa; margin-bottom: 3px; }
    .note-block .status {
      position: absolute; top: 6px; right: 6px; padding: 2px 8px;
      border-radius: 4px; font-size: 0.8em; font-weight: bold; cursor: pointer;
    }
    .note-block[data-status="todo"] .status { background: #fcb900; color: #000; }
    .note-block[data-status="progress"] .status { background: #4299e1; color: #fff; }
    .note-block[data-status="done"] .status { background: #38a169; color: #fff; }

    table { width: 100%; border-collapse: collapse; margin: 0.5rem 0; }
    th, td { border: 1px solid #4fd1c5; padding: 0.6rem; text-align: left; }
    th { background: #233040; color: #fcb900; }

    button { margin-top: 0.5rem; padding: 6px 12px; border: none;
      background: #4fd1c5; color: #000; border-radius: 5px; cursor: pointer;
    }
    button:hover { background: #38b2ac; color: #000; }

    .filter-line { margin-top: 0.8rem; display: flex; flex-wrap: wrap; align-items: center; gap: 0.5rem; }
    .filter-line button { background: #233040; color: #ddd; font-size: 0.9em;
      padding: 4px 10px; border: none; border-radius: 5px; cursor: pointer;
    }
    .filter-line button.active { background: #fcb900; color: #000; }

    @media (max-width: 700px) {
      .flex-row { flex-direction: column; }
      .note-entry { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header><h1>üìΩÔ∏è Outil Production & Tournage ‚Äì L'Ar√®ne</h1></header>

  <div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'Modules')">Modules & Notes</button>
    <button class="tablinks" onclick="openTab(event, 'Crew')">Intervenants</button>
    <button class="tablinks" onclick="openTab(event, 'Equipment')">√âquipement</button>
    <button class="tablinks" onclick="openTab(event, 'Schedule')">Planning</button>
  </div>

  <!-- Modules & Notes -->
  <div id="Modules" class="tabcontent active">
    <div id="container"></div>
  </div>

  <!-- Intervenants -->
  <div id="Crew" class="tabcontent">
    <details>
      <summary>Liste des intervenants</summary>
      <table>
        <thead>
          <tr><th>Nom</th><th>R√¥le</th><th>Contact</th></tr>
        </thead>
        <tbody id="crewList"></tbody>
      </table>
      <div class="flex-row">
        <input type="text" id="crew_name" placeholder="Nom">
        <input type="text" id="crew_role" placeholder="R√¥le">
        <input type="text" id="crew_contact" placeholder="Contact">
        <button onclick="addCrew()">Ajouter intervenant</button>
      </div>
    </details>
  </div>

  <!-- √âquipement -->
  <div id="Equipment" class="tabcontent">
    <details>
      <summary>√âquipement & Mat√©riel</summary>
      <table>
        <thead>
          <tr><th>√âl√©ment</th><th>Quantit√©</th><th>Statut</th></tr>
        </thead>
        <tbody id="equipList"></tbody>
      </table>
      <div class="flex-row">
        <input type="text" id="equip_item" placeholder="√âquipement">
        <input type="text" id="equip_qty" placeholder="Quantit√©">
        <select id="equip_status">
          <option>Disponible</option>
          <option>√Ä louer</option>
          <option>En panne</option>
        </select>
        <button onclick="addEquip()">Ajouter</button>
      </div>
    </details>
  </div>

  <!-- Planning -->
  <div id="Schedule" class="tabcontent">
    <details>
      <summary>Calendrier de Tournage</summary>
      <table>
        <thead>
          <tr><th>Module</th><th>Date</th><th>Heure</th></tr>
        </thead>
        <tbody id="scheduleList"></tbody>
      </table>
      <div class="flex-row">
        <select id="sched_module"></select>
        <input type="date" id="sched_date">
        <input type="time" id="sched_time">
        <button onclick="addSchedule()">Ajouter</button>
      </div>
    </details>
  </div>

<script>
// Configuration des modules (chef op + lieu pr√©rempli)
const modules = [
  "Convois",
  "Portraits √©crans & beauties",
  "Sac de frappe",
  "Tra√Æneaux",
  "V√©los",
  "Combat piscine",
  "Lutte des territoires",
  "Bains glac√©s",
  "Combats √©liminatoires"
];
const config = {
  0: ["Neel Poettinger", ""],
  1: ["Julien Lascar / Sacha Wiernik", "Portraits √©crans: HANGAR FROIDS / Portraits beauties: Ext & Int SILO"],
  2: ["Julien Lascar", "HANGAR HM10"],
  3: ["Julien Lascar", "HANGAR HM10"],
  4: ["Neel Poettinger", "HANGAR HM10"],
  5: ["Neel Poettinger", ""],
  6: ["Neel Poettinger", ""],
  7: ["Julien Lascar", "HANGAR HM10"],
  8: ["", ""]
};
let currentFilters = {};

// Ouvrir un onglet
function openTab(evt, tabName) {
  document.querySelectorAll(".tabcontent").forEach(tc => tc.classList.remove("active"));
  document.querySelectorAll(".tablinks").forEach(btn => btn.classList.remove("active"));
  document.getElementById(tabName).classList.add("active");
  evt.currentTarget.classList.add("active");
}

// Rendu des modules + notes
function renderModules() {
  const c = document.getElementById("container");
  modules.forEach((mod, i) => {
    const id = "mod" + i;
    const chef = config[i][0];
    const lieu = config[i][1];
    c.innerHTML += `
<details id="${id}">
  <summary>${mod}</summary>
  <label>üé• Chef op√©rateur</label>
  <input type="text" value="${chef}" readonly/>
  <label>üìç Lieu</label>
  <input type="text" value="${lieu}" readonly/>
  <label>üìù Ajouter une note</label>
  <div class="note-entry">
    <input type="text" id="${id}_author" placeholder="Nom">
    <input type="text" id="${id}_text" placeholder="Note...">
    <button onclick="addNote('${id}')">Ajouter</button>
  </div>
  <div class="filter-line">
    <span>Filtrer :</span>
    <button onclick="filter('${id}','all')" class="active">Tous</button>
    <button onclick="filter('${id}','todo')">√Ä traiter</button>
    <button onclick="filter('${id}','progress')">En cours</button>
    <button onclick="filter('${id}','done')">Trait√©</button>
  </div>
  <div id="${id}_notes"></div>
</details>`;
    loadNotes(id);
  });
}

// √âtiquette de statut
function getStatusLabel(code) {
  return { todo:"√Ä traiter", progress:"En cours", done:"Trait√©" }[code];
}

// Ajout d'une note dans un module
function addNote(id) {
  const name = document.getElementById(id + "_author").value.trim();
  const text = document.getElementById(id + "_text").value.trim();
  if (!text) return;
  const div = document.createElement("div");
  div.className = "note-block"; div.dataset.status = "todo";
  div.innerHTML = `<div class="meta">${name || "Anonyme"}</div>
    <div>${text}</div>
    <div class="status" onclick="toggleStatus(this.parentElement)">${getStatusLabel("todo")}</div>`;
  document.getElementById(id + "_notes").appendChild(div);
  document.getElementById(id + "_text").value = "";
  saveNotes(id);
  filter(id, currentFilters[id] || 'all');
}

// Changement de statut par clic
function toggleStatus(el) {
  const states = ["todo","progress","done"];
  const labels = ["√Ä traiter","En cours","Trait√©"];
  let cur = states.indexOf(el.dataset.status);
  let next = (cur + 1) % 3;
  el.dataset.status = states[next];
  el.querySelector(".status").innerText = labels[next];
  saveNotes(el.closest("details").id);
  filter(el.closest("details").id, currentFilters[el.closest("details").id] || 'all');
}

// Sauvegarde des notes dans localStorage
function saveNotes(id) {
  const blocks = [...document.querySelectorAll("#" + id + "_notes .note-block")];
  const notes = blocks.map(div => ({
    html: div.innerHTML,
    status: div.dataset.status
  }));
  localStorage.setItem(id + "_notes", JSON.stringify(notes));
}

// Chargement des notes depuis localStorage
function loadNotes(id) {
  const data = localStorage.getItem(id + "_notes");
  if (!data) return;
  const area = document.getElementById(id + "_notes");
  JSON.parse(data).forEach(n => {
    const div = document.createElement("div");
    div.className = "note-block"; div.dataset.status = n.status;
    div.innerHTML = n.html;
    area.appendChild(div);
  });
}

// Filtrer les notes selon leur statut
function filter(id, stat) {
  currentFilters[id] = stat;
  const buttons = document.querySelectorAll("#" + id + " .filter-line button");
  buttons.forEach(b => b.classList.remove("active"));
  document.querySelector(`#${id} .filter-line button[onclick*="${stat}"]`).classList.add("active");
  document.querySelectorAll("#" + id + " .note-block").forEach(n => {
    n.style.display = (stat === "all" || n.dataset.status === stat) ? "block" : "none";
  });
}

// Rendu de la table des intervenants
function loadCrew() {
  const data = localStorage.getItem("crew_list");
  if (!data) return;
  const tbl = document.getElementById("crewList");
  JSON.parse(data).forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${c.name}</td><td>${c.role}</td><td>${c.contact}</td>`;
    tbl.appendChild(tr);
  });
}

// Ajout d'un intervenant
function addCrew() {
  const name = document.getElementById("crew_name").value.trim();
  const role = document.getElementById("crew_role").value.trim();
  const contact = document.getElementById("crew_contact").value.trim();
  if (!name || !role) return;
  const entry = { name, role, contact };
  const data = JSON.parse(localStorage.getItem("crew_list") || "[]");
  data.push(entry);
  localStorage.setItem("crew_list", JSON.stringify(data));
  document.getElementById("crew_name").value = "";
  document.getElementById("crew_role").value = "";
  document.getElementById("crew_contact").value = "";
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${name}</td><td>${role}</td><td>${contact}</td>`;
  document.getElementById("crewList").appendChild(tr);
}

// Rendu de la table d'√©quipement
function loadEquip() {
  const data = localStorage.getItem("equip_list");
  if (!data) return;
  const tbl = document.getElementById("equipList");
  JSON.parse(data).forEach(e => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${e.item}</td><td>${e.qty}</td><td>${e.status}</td>`;
    tbl.appendChild(tr);
  });
}

// Ajout d'un √©quipement
function addEquip() {
  const item = document.getElementById("equip_item").value.trim();
  const qty = document.getElementById("equip_qty").value.trim();
  const status = document.getElementById("equip_status").value;
  if (!item || !qty) return;
  const entry = { item, qty, status };
  const data = JSON.parse(localStorage.getItem("equip_list") || "[]");
  data.push(entry);
  localStorage.setItem("equip_list", JSON.stringify(data));
  document.getElementById("equip_item").value = "";
  document.getElementById("equip_qty").value = "";
  document.getElementById("equip_status").value = "Disponible";
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${item}</td><td>${qty}</td><td>${status}</td>`;
  document.getElementById("equipList").appendChild(tr);
}

// Rendu du planning
function loadSchedule() {
  const data = localStorage.getItem("sched_list");
  if (!data) return;
  const tbl = document.getElementById("scheduleList");
  JSON.parse(data).forEach(s => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${s.mod}</td><td>${s.date}</td><td>${s.time}</td>`;
    tbl.appendChild(tr);
  });
}

// Ajout d'une entr√©e planning
function addSchedule() {
  const mod = document.getElementById("sched_module").value;
  const date = document.getElementById("sched_date").value;
  const time = document.getElementById("sched_time").value;
  if (!mod || !date || !time) return;
  const entry = { mod, date, time };
  const data = JSON.parse(localStorage.getItem("sched_list") || "[]");
  data.push(entry);
  localStorage.setItem("sched_list", JSON.stringify(data));
  document.getElementById("sched_date").value = "";
  document.getElementById("sched_time").value = "";
  const tr = document.createElement("tr");
  tr.innerHTML = `<td>${mod}</td><td>${date}</td><td>${time}</td>`;
  document.getElementById("scheduleList").appendChild(tr);
}

// Initialisation du s√©lecteur de modules pour le planning
function initScheduleSelect() {
  const sel = document.getElementById("sched_module");
  modules.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m; opt.text = m;
    sel.appendChild(opt);
  });
}

// --- Initialisation √† l‚Äôouverture ---
renderModules();
loadCrew();
loadEquip();
initScheduleSelect();
loadSchedule();
</script>
</body>
</html>
